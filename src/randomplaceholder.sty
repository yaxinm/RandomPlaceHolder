\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{randomplaceholder}[2022/10/05 Insert a random image as a placeholder.]

\RequirePackage{graphicx}
\RequirePackage{lcg}
\RequirePackage{xargs}
\RequirePackage{float}


\def\bashmkmacro#1{
    FILE=placeholdermacros.tmp;
    if [ -f $FILE ]; then exit 0; fi;
    printf "\\ def\\ placeholderpath{#1}" > $FILE;
    echo " " >> $FILE;
    echo "\\ reinitrand[first=1, last=$(ls #1 | wc -l), counter=fignum]" >> $FILE;
    echo " " >> $FILE;
    echo "\\ def\\ placeholderimage##1{" >> $FILE;
    echo "    \\ ifcase##1\\ relax" >> $FILE;
    for IMG in \expandafter$(ls #1); do echo "    \\ or\\ placeholderpath/$IMG" >> $FILE; done;
    echo "    \\ fi" >> $FILE;
    echo "}" >> $FILE;
    echo "\\ input{placeholderinit_part2.tex}" >> $FILE;
    sed -i 's/\\ /\\/g' $FILE;
    sed -i 's/##/\#/g' $FILE;
}

\def\app@exe{\immediate\write18}
\def\placeholderinit#1{%
    \app@exe{\bashmkmacro{#1}}
    \input{placeholdermacros.tmp}
}
\def\placeholderclean{%
    \app@exe{rm placeholdermacros.tmp}
}

\endinput